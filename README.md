# RCget - radio clock decoder in MicroPython
Radio clock modules enable fully automatic date and time setting of the onboad RTC with accuracies of a few milliseconds and are a micropower and cheap alternative to battery-powered RTCs. These micropython modules (written for the Pico) provide detection and decoding for the MSF, DCF77, WWVB and JJY transmitters that give good coverage for practically all of Europe, North America and Japan. For weak signal areas, much greater immunity from noise and signal corruption is achieved compared with simple protocols.
## Details
All the timecode transmissions employ similar variable pulse length encoding but here, rather than attempting to measure pulse length using edge detection (which is highly susceptible to noise triggers) sampling during the pulse period is used. This removes up to 90% of any noise pulses and then by averaging over the sample most of the remaining short noise pulses are eliminated.
Details of the timecode transmissions are given by  [MSF](https://www.npl.co.uk/products-services/time-frequency/msf-radio-time-signal/msf_time_date_code), [DCF77](https://www.ptb.de/cms/en/ptb/fachabteilungen/abt4/fb-44/ag-442/dissemination-of-legal-time/dcf77/dcf77-time-code.html), [WWVB](https://www.nist.gov/pml/time-and-frequency-division/time-distribution/radio-station-wwvb/wwvb-time-code-format) & [JJY](http://www.c-max-time.com/tech/jjy.php). There is not yet a version here for BPC in China.  
RCget first measures the offset between the received pulses and the millisecond timer to determine the sampling period. Timer-initiated sampling of the pulse periods then starts. On detection of the end-of-signal code the BCD string is decoded to yield the timecode. Some transmissions employ parity checking but, even if present, this is weak and, since there is no way to confirm that a received signal is correct, simple statistical verification is used by collecting and comparing two or more timecode strings for matching values. This provides a final stage of strong error removal while eliminating the need for a single full correct timecode string. The RTC is then set.  
In tests, correct timecodes have been decoded with noise levels over 50% (half of the received pulses are noise) and no incorrect date-times have been produced. If the signal is really poor the decoder will fail to find a match and exit.
Although timecodes have a daylight saving time (DST) indication, this is decoded only for the DCF77 protocol, which has a parity bit. The MSF transmission has only a single bit for DST with no parity check so it could be very easily corrupted. Japan doesn’t observe DST so doesn’t employ the DST bits. The RTC is always set to UTC and [loc_time()](https://github.com/dt78q/micropython-localtime) should then be used to give geographic local time with daylight saving times.
## Practical notes
There are several pre-built modules available that have ferrite core antennas combined with the detection and demodulation stages (e.g. mas-oy). Examples of the cheap JJY1060N MAS for MSF and DCF-3850N-800 (RC8000) types have been tested and work very well although the latter did not work at the 3.3V supply from the Pico and a 3.9 kΩ series resistor had to be added to drop the voltage. However, a resistor/capacitor filter is probably a good general precaution and a pair of 1.5V cells are ideal as a clean power supply for initial testing. [Canaduino](https://www.canaduino.ca/?s=atomic+clock&post_type=product&type_aws=true) also offer modules that appear to be higher quality. There is plenty of information online for the use of these modules. The axis of the ferrite rod should be perpendicular to the direction of the transmitter (broadside on) but is not critical. Noise sources such as  monitors and SMPS power supplies (that are now ubiquitous in electronic equipment, including the Pico) should be avoided. It can take a minute for a module to start producing pulses from powering up. Some modules allegedly need an input pull up, some can't drive a pull up. Some modules have an enable control for low-power standby & fast startup; there is a setting for this.  
In weak signal areas the early hours of the morning will give stronger signals with less noise. For MSF and WWVB DST is inferred from the local time and therefore use should be avoided during the undefined (double) hour of the ‘back’ DST change.  
Neither  the WWVB or JJY version have been tested on real signals so any feedback on their use would be useful. In the JJY broadcast the signal is inverted (pulse is modulation high) so in the code edge detection is set to falling. It might be necessary to invert the pulse polarity and polarity of the end marker (in the sampling section) so experimentation might be necessary.
